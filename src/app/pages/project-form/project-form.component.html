<section class="project-form">
  <h2>{{ projectId ? 'Edit Project' : 'Add Project' }}</h2>

  <form (ngSubmit)="saveProject(); $event.preventDefault()">
    <!-- Project Basics -->
    <div class="project-info">
      <label>Project Name</label>
      <input type="text" [(ngModel)]="projectName" name="projectName" required />

      <label>Description</label>
      <textarea [(ngModel)]="projectDesc" name="projectDesc"></textarea>
    </div>

    <!-- Forces -->
    <div class="force-section">
      <div class="section-header">
        <h3>Forces</h3>
        <button type="button" class="add-btn" (click)="openForceModal()">+ Add Force</button>
      </div>

      @for (force of forces(); track force.id) {
        <div class="force-card">
          <div class="force-header">
            <h4>{{ force.name || 'Unnamed Force' }}</h4>
            <button type="button" class="remove-icon" (click)="removeForce(force.id)">✖</button>
          </div>

          <!-- Units -->
          <div class="unit-list">
            @for (unit of force.units; track unit.id) {
              <div class="unit-card">
                <div class="unit-header">
                  <span>{{ unit.name || 'Unnamed Unit' }}</span>
                  <button type="button" class="remove-icon" (click)="removeUnit(force.id, unit.id)">✖</button>
                </div>

                <!-- Minis -->
                <div class="mini-list">
                  @for (mini of unit.minis; track mini.id) {
                    <div class="mini-item">
                      <span>{{ mini.name || 'Unnamed Mini' }}</span>
                      <button type="button" class="remove-icon" (click)="removeMini(force.id, unit.id, mini.id)">✖</button>
                    </div>
                  }
                </div>

                <button type="button" class="mini-add" (click)="openMiniModal(force.id, unit.id)">+ Add Mini</button>
              </div>
            }
          </div>

          <button type="button" class="unit-add" (click)="openUnitModal(force.id)">+ Add Unit</button>
        </div>
      }
    </div>

    <button type="submit" class="save-btn">Save Project</button>
  </form>

  <!-- ===================== -->
  <!-- Inline Force Modal -->
  <!-- ===================== -->
  @if (showForceModal()) {
    <app-force-modal
      (save)="onForceSaved($event)"
      (close)="closeForceModal()">
    </app-force-modal>
  }

  <!-- ===================== -->
  <!-- Inline Unit Modal -->
  <!-- ===================== -->
  @if (showUnitModal()) {
    <app-unit-modal
      (save)="onUnitSaved($event)"
      (close)="closeUnitModal()">
    </app-unit-modal>
  }

  <!-- ===================== -->
  <!-- Inline Mini Modal -->
  <!-- ===================== -->
  @if (showMiniModal()) {
    <app-mini-modal
      (save)="onMiniSaved($event)"
      (close)="closeMiniModal()">
    </app-mini-modal>
  }
</section>
